---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---
<BaseLayout title={post.data.title} description={post.data.description}>
  <article class="mx-auto max-w-3xl">
    <div class="not-prose mb-8 overflow-hidden rounded-2xl border border-ink/10 bg-white/70 shadow-sm">
      <div class="relative aspect-[16/9] w-full">
        {post.data.heroImage ? (
          <img
            src={post.data.heroImage.src}
            alt={`Banner image for ${post.data.title}`}
            class="h-full w-full object-cover"
            loading="eager"
            decoding="async"
          />
        ) : (
          <div class="flex h-full w-full items-end bg-gradient-to-br from-sand via-white to-amber-100 p-6">
            <div class="rounded-lg border border-white/60 bg-white/70 px-4 py-3 backdrop-blur">
              <p class="text-[11px] uppercase tracking-[0.25em] text-ink/60">Banner image</p>
              <p class="mt-1 text-sm text-ink/80">Add `heroImage` to this post frontmatter to display a cover.</p>
            </div>
          </div>
        )}
      </div>
    </div>
    <div class="mb-8">
      <p class="text-xs uppercase tracking-[0.4em] text-ink/60">{post.data.tags?.[0] ?? 'Essay'}</p>
      <h1 class="mt-3 text-4xl font-semibold leading-tight">{post.data.title}</h1>
      <p class="mt-3 text-base text-ink/70">{post.data.description}</p>
      <time class="mt-4 block text-sm text-ink/60" datetime={post.data.pubDate.toISOString()}>
        {post.data.pubDate.toLocaleDateString('en-US', {
          month: 'long',
          day: 'numeric',
          year: 'numeric'
        })}
      </time>
    </div>
    <div class="prose prose-neutral max-w-none">
      <Content />
    </div>
  </article>
</BaseLayout>
